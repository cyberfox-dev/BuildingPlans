



<button class="actioncenter" (click)="openXl(content)"><a>Action Center</a></button>


<ng-template #content let-modal>
  <div class="modal-header">
    <h1 class="modal-title">Action center</h1>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
  </div>
  <div class="modal-body">
    <div class="cont">
      <button mat-raised-button color="blue" (click)="openAssignDepartment(assign)">Assign a Department to this project</button>
      <button mat-raised-button color="blue" *ngIf="AssignProjectToZone == true" (click)="openAssignToZone(assignProjectToZone)">Assign this project to a zone</button>
      <button mat-raised-button color="blue" *ngIf="AssignUserForComment == true" (click)="openAssignToUser(assignProjectToUser)">Assign this project to a user manually</button>
      <!-- <button mat-raised-button color="blue" *ngIf="hopperButton == true" (click)="onHopperClick()">Hopper</button>-->
    </div>

    <br>
    <mat-divider></mat-divider>
    <br>
    <mat-form-field class="example-full-width">
      <mat-label>Type new comment</mat-label>
      <textarea matInput [(ngModel)]="leaveAComment" placeholder="Eg. This is good"></textarea>

    </mat-form-field>
    <button mat-raised-button color="purple" [matMenuTriggerFor]="menu" (click)="getAllCommentsByUserID()"><i class="fa fa-comment" aria-hidden="true"></i></button>
    <mat-menu #menu="matMenu" xPosition="before">
      <button mat-menu-item *ngFor="let comment of CommentDropDown" value="{{comment.commentID}}" (click)="populateComment(comment.commentName)">{{comment.commentName}} </button>

    </mat-menu>

    <div class="cont2">
      <button mat-raised-button color="approveBTN" (click)="onComment('Approve')"><i class="fa fa-thumbs-up greenThumbsUp" aria-hidden="true"></i>  Approve</button>
      <button mat-raised-button color="rejectBTN" (click)="onComment('Reject')"><i class="fa fa-thumbs-down redThumbsDown" aria-hidden="true"></i>  Reject</button>
      <button mat-raised-button color="clarifyBTN" (click)="onComment('Clarify')"><i class="fa fa-commenting-o orangeSpeech" aria-hidden="true"></i>  Clarify</button>
      <button mat-raised-button color="referBTN" (click)="onComment('Refer')"><i class="fa fa-retweet blueRefer" aria-hidden="true"></i>  Refer</button>
    </div>
    <div class="cont3">
      <!--this is for the wbs number -->
      <mat-checkbox class="example-margin" [(ngModel)]="checked" (click)="enterWBSNumberModal(wbsNumberModal)" *ngIf="isExternalUser">WBS Number</mat-checkbox>

      <!--this is for the deposit required-->
      <mat-checkbox class="example-margin" [(ngModel)]="checked" (click)="depositReqModal(deposit)" *ngIf="isInternalUser">Deposit Required</mat-checkbox>
    </div>

  </div>

</ng-template>


<!--modal for when they click deposit required-->


<ng-template #deposit let-modal>
  <div class="modal-header">
    <h1 class="modal-title">Deposit Required</h1>
    <button type="button" class="btn-close" aria-label="Close" (click)="uncheck();modal.dismiss('Cross click')"></button>
  </div>
  <div class="modal-body">
    <form [formGroup]="depositRequired">
      <div class="row">
        <div class="col">
          <div class="form-floating mb-3 mt-3">
            <select class="form-select" aria-label="Default select example" formControlName="selectServiceItemCode" (change)="onPopulateDeposit($event)">
              <option selected value="0">Select Service Item Code</option>
              <option *ngFor="let serviceItemCode of ServiceItemCodeDropdown" value="{{serviceItemCode.serviceItemID}}">{{serviceItemCode.serviceItemCode}}</option>
            </select>
          </div>
        </div>
        <div class="col">
          <div class="form-floating mb-3 mt-3">
            <input type="text" class="form-control" formControlName="description" placeholder="Description">
            <label for="description">Description</label>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <div class="col">
            <div class="form-floating mb-3 mt-3">
              <input type="text" class="form-control" formControlName="rate" placeholder="Enter Rate">
              <label for="rate">Rate</label>
            </div>
          </div>
        </div>
        <div class="col">
          <div class="form-floating mb-3 mt-3">
            <input type="text" class="form-control" formControlName="quantity" placeholder="Enter Quantity">
            <label for="quantity">Quantity</label>
          </div>
        </div>
      </div>
      <div class="row">

        <div class="form-floating mb-3 mt-3">
          <input type="text" class="form-control" formControlName="total" placeholder="Enter Total" readonly>
          <label for="total">Total exc. Vat</label>
        </div>

      </div>
    </form>
  </div>

  <div class="cont4">
    <button mat-raised-button color="warn" (click)="uncheck();modal.dismiss('Cross click')">Cancel</button>
    <button mat-raised-button color="save" (click)="check();modal.close('Save click')">Save</button>

  </div>


</ng-template>

<ng-template #assign let-modal>
  <div class="modal-header">
    <h1 class="modal-title">Assign Project to a department</h1>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
  </div>
  <div class="modal-body">
    <mat-tab-group>
      <mat-tab label="Select departments">



        <table mat-table [dataSource]="dataSourceSubDepartment" class="mat-elevation-z8">

          <ng-container matColumnDef="subDepartmentName">
            <th mat-header-cell *matHeaderCellDef> Sub Department Name </th>
            <td mat-cell *matCellDef="let element"> {{element.subDepartmentName}} </td>
          </ng-container>


          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Actions</th>
            <td mat-cell *matCellDef="let i = index;let element">
              <mat-checkbox class="example-margin" (change)="departmentSelectedForLink(element)" [checked]="selection.isSelected(element)"></mat-checkbox>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumnsSubDepartment"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumnsSubDepartment;"></tr>
        </table>
      </mat-tab>

      <mat-tab label="View Selected Departments">

        <table mat-table [dataSource]="dataSourceLinkedSubDepartment" class="mat-elevation-z8">



          <ng-container matColumnDef="subDepartmentName">
            <th mat-header-cell *matHeaderCellDef> Sub Department Name </th>
            <td mat-cell *matCellDef="let element"> {{element.subDepartmentName}} </td>
          </ng-container>


          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Actions</th>
            <td mat-cell *matCellDef="let i = index;let element">
              <button mat-raised-button color="warn" (click)="deleteLinkedDepartmentForComment(i);modal.dismiss('Cross click');getAllSubDepartments()"><i class="fa fa-trash" aria-hidden="true"></i></button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumnsSubDepartment"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumnsLinkedSubDepartment;"></tr>
        </table>

      </mat-tab>
    </mat-tab-group>
  </div>
  <div class="modal-footer">
    <button type="submit" class="btn btn-outline-success" (click)="onLinkDepartmentForComment();modal.close('Save click');getAllSubDepartments()">Save</button>
  </div>

</ng-template>

<ng-template #assignProjectToZone let-modal>
  <div class="modal-header">
    <h1 class="modal-title">Assign Project to a zone</h1>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
  </div>
  <div class="modal-body">
    <mat-tab-group>
      <mat-tab label="Select zones">



        <table mat-table [dataSource]="dataSourceViewLinkedSubZones" class="mat-elevation-z8">

          <ng-container matColumnDef="zoneName">
            <th mat-header-cell *matHeaderCellDef> Zone Name  </th>
            <td mat-cell *matCellDef="let element"> {{element.zoneName}} </td>
          </ng-container>


          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Actions</th>
            <td mat-cell *matCellDef="let i = index;let element">
              <mat-checkbox class="example-margin" (change)="zoneSelectedForLink(element)" [checked]="zoneSelection.isSelected(element)"></mat-checkbox> 
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumnsViewLinkedSubZones"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumnsViewLinkedSubZones;"></tr>
        </table>
      </mat-tab>

      <mat-tab label="Linked Zones">

        <table mat-table [dataSource]="dataSourceViewLinkedZones" class="mat-elevation-z8">



          <ng-container matColumnDef="zoneName">
            <th mat-header-cell *matHeaderCellDef> Zone Name </th>
            <td mat-cell *matCellDef="let element"> {{element.zoneName}} </td>
          </ng-container>


          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Actions</th>
            <td mat-cell *matCellDef="let i = index;let element">
              <button mat-raised-button color="warn" (click)="deleteLinkedZoneForComment(i);modal.dismiss('Cross click')"><i class="fa fa-trash" aria-hidden="true"></i></button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumnsViewLinkedZones"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumnsViewLinkedZones;"></tr>
        </table>

      </mat-tab>
    </mat-tab-group>
  </div>
  <div class="modal-footer">
    <button type="submit" class="btn btn-outline-success" (click)="onLinkZoneForComment();modal.close('Save click')">Save</button>
  </div>

</ng-template>

<ng-template #assignProjectToUser let-modal>
  <div class="modal-header">
    <h1 class="modal-title">Assign Project to a user</h1>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
  </div>
  <div class="modal-body">
    <mat-tab-group>
      <mat-tab label="Select User">

               <!--<div class="form-floating mb-3 mt-3" >
          <select class="form-select" aria-label="Default select example" formControlName="selectedZone" (change)="onSelectToPopulateZoneUsers($event,newUserLinkedToZone)">
            <option selected value="0">select a zone</option>
            <option *ngFor="let zone of ZoneDropdown" value="{{zone.zoneID}}">{{zone.zoneName}}</option>
          </select>

        </div>-->

             <table mat-table [dataSource]="dataSourceViewUsersForLink" class="mat-elevation-z8">

    <ng-container matColumnDef="fullName">
      <th mat-header-cell *matHeaderCellDef> User Name  </th>
      <td mat-cell *matCellDef="let element"> {{element.fullName}} </td>
    </ng-container>


    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef>Actions</th>
      <td mat-cell *matCellDef="let i = index;let element">
                 <mat-radio-button class="example-margin" (change)="userSelectedForManualLink(element)" [checked]="UserSelectionForManualLink.isSelected(element)">
          </mat-radio-button>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumnsViewUsersForLink"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumnsViewUsersForLink;"></tr>
  </table>
      </mat-tab>

      <mat-tab label="View Slected User">

                <!--<div class="form-floating mb-3 mt-3" *ngIf="showZone">
           <select class="form-select" aria-label="Default select example" formControlName="viewSelectedZone" (change)="onSelectToPopulateZoneUsers($event,newUserLinkedToZone)">
             <option selected value="0">select a zone</option>
             <option *ngFor="let zone of ZoneDropdown" value="{{zone.zoneID}}">{{zone.zoneName}}</option>
           </select>

         </div>-->

                <table mat-table [dataSource]="dataSourceViewUserForComment" class="mat-elevation-z8">



     <ng-container matColumnDef="fullName">
       <th mat-header-cell *matHeaderCellDef> User Name </th>
       <td mat-cell *matCellDef="let element"> {{element.fullName}} </td>
     </ng-container>


     <!--<ng-container matColumnDef="actions">
       <th mat-header-cell *matHeaderCellDef>Actions</th>
       <td mat-cell *matCellDef="let i = index;let element">-->
        <!-- <button mat-raised-button color="warn" (click)="deleteLinkedZoneForComment(i);modal.dismiss('Cross click')"><i class="fa fa-trash" aria-hidden="true"></i></button>-->
       <!--</td>
     </ng-container>-->

     <tr mat-header-row *matHeaderRowDef="displayedColumnsViewlinkedUserForComment"></tr>
     <tr mat-row *matRowDef="let row; columns: displayedColumnsViewlinkedUserForComment;"></tr>
   </table>

      </mat-tab>
    </mat-tab-group>
  </div>
  <div class="modal-footer">
    <button type="submit" class="btn btn-outline-success" (click)="onManuallyAssignUser();modal.close('Save click')">Save</button>
  </div>

</ng-template>


<ng-template #depositOrWBSNumber let-modal>
  <div class="modal-header">
    <h1 class="modal-title">Approve</h1>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
  </div>
  <div class="modal-body">


      <h3>Do you want to add a deposit required ?</h3>
      <h3>Do you want to add a WBS Number ?</h3>
      <div class="cont3">
        <button mat-button>No</button>
        <button mat-raised-button (click)="depositReqModal(deposit)">Yes</button> 

      </div>
    
  </div>

</ng-template>


<!--This is for the wbs number-->

<ng-template #wbsNumberModal let-modal>
  <div class="modal-header">
    <h1 class="modal-title">WBS Number</h1>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
  </div>
  <div class="modal-body">

    <div class="form-floating mb-3 mt-3">
      <input type="text" class="form-control" formControlName="wbsnumber" placeholder="wbsnumber">
      <label for="wbsnumber">WBS Number</label>
    </div>

  </div>
  <div class="modal-footer">
    <button type="submit" class="btn btn-outline-success" (click)="modal.close('Save click')">Save</button>
  </div>
</ng-template>

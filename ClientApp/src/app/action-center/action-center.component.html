<div class="cont5">
  <button mat-raised-button color="createWayleave" (click)="openXl(content)">Action Center</button>
</div>


<ng-template #content let-modal>
  <div class="modal-header">
    <h1 class="modal-title">Action Center</h1>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
  </div>
  <div class="modal-body" *ngIf="CurrentApplication.isPlanning != true">
    <div class="cont">
      <!--<button mat-raised-button color="blue" *ngIf="CanAssignDepartment == true && canCommentFinalApprover == false && showPermitTab === false" (click)="openAssignDepartment(assign)">Assign Department to Project</button>-->
      <!--<button mat-raised-button color="blue" *ngIf="AssignProjectToZone == true && canCommentFinalApprover == false && showPermitTab === false" (click)="openAssignToZone(assignProjectToZone)">Assign Project to Zone</button>-->
      <button mat-raised-button color="blue" *ngIf="AssignUserForComment == true && canCommentFinalApprover == false && showPermitTab === false" (click)="openAssignToUser(assignProjectToUser)">Assign User For Comment</button>
      <!-- <button mat-raised-button color="blue" *ngIf="hopperButton == true" (click)="onHopperClick()">Hopper</button>-->
    </div>

    <br>
    <mat-divider *ngIf="CurrentApplication.isPlanning != true"></mat-divider>
    <br>
    <mat-form-field class="example-full-width" *ngIf="canComment == true || canCommentFinalApprover == true || canCommentSeniorReviewer == true">
      <!--|| canCommentFinalApprover == true-->
      <mat-label>Type New Comment/Special Condition </mat-label>
      <textarea matInput [(ngModel)]="leaveAComment" placeholder="Eg. This is good"></textarea>

    </mat-form-field>
    <button mat-raised-button color="purple" [matMenuTriggerFor]="menu" (click)="getAllCommentsByUserID()" *ngIf="canComment == true || canCommentFinalApprover == true || canCommentSeniorReviewer == true"><i class="fa fa-comment" aria-hidden="true"></i></button>
    <mat-menu #menu="matMenu" xPosition="before">
      <button mat-menu-item *ngFor="let comment of CommentDropDown" value="{{comment.commentID}}" (click)="populateComment(comment.commentName)">{{comment.commentName}} </button>

    </mat-menu>

    <div class="cont2" *ngIf="canComment == true && canCommentFinalApprover == false">
      <button mat-raised-button color="approveBTN" (click)="onComment('Approve')"><i class="fa fa-thumbs-up greenThumbsUp" aria-hidden="true"></i>  Approved</button>
      <button mat-raised-button color="rejectBTN" (click)="onComment('Reject')"><i class="fa fa-thumbs-down redThumbsDown" aria-hidden="true"></i>  Not Approved</button>
      <button mat-raised-button color="clarifyBTN" (click)="onComment('Clarify');sendOption()"><i class="fa fa-commenting-o orangeSpeech" aria-hidden="true"></i>  Clarify</button>
      <button mat-raised-button color="referBTN" (click)="onComment('Refer')"><i class="fa fa-retweet blueRefer" aria-hidden="true"></i>  Refer</button>
    </div>
    <div class="cont2" *ngIf="canCommentSeniorReviewer == true">
      <button mat-raised-button color="approveBTN" (click)="onCommentSR('Approve')"><i class="fa fa-thumbs-up greenThumbsUp" aria-hidden="true"></i>  Approved</button>
      <button mat-raised-button color="rejectBTN" (click)="onCommentSR('Reject')"><i class="fa fa-thumbs-down redThumbsDown" aria-hidden="true"></i>  Not Approved</button>
      <button mat-raised-button color="clarifyBTN" (click)="onCommentSR('Clarify');sendOption()"><i class="fa fa-commenting-o orangeSpeech" aria-hidden="true"></i>  Clarify</button>

    </div>
    <div class="cont2" *ngIf="canCommentFinalApprover == true">
      <!-- -->
      <button mat-raised-button color="approveBTN" (click)="FinalApprove('Approve')"><i class="fa fa-thumbs-up greenThumbsUp" aria-hidden="true"></i> Approved</button>
      <button mat-raised-button color="rejectBTN" (click)="FinalApprove('Reject')"><i class="fa fa-thumbs-down redThumbsDown" aria-hidden="true"></i> Not Approved</button>

    </div>
    <div class="cont3">
      <!--this is for the wbs number -->
      <mat-checkbox class="example-margin" *ngIf="canComment == true || canCommentSeniorReviewer == true && canCommentFinalApprover == false" [(ngModel)]="checked">WBS Number</mat-checkbox>

      <!--This is for the document upload-->

      <mat-form-field *ngIf="CurrentApplication.isPlanning === true">
        <div>
          <mat-toolbar>

          <!-- <input matInput [(ngModel)]="fileAttrs[0]" readonly name="name" />-->

            <div class="row">
              <div class="container-fluid">
                <div class="row" style="margin-bottom:15px;">
                  <div class="container-fluid">

                    <input matInput [(ngModel)]="fileAttrs" readonly name="name" />
                    <!-- app-file-upload Component -->
                    <div class="row" style="margin-bottom:15px;">
                      <div class="container-fluid">
                        <app-file-upload [ApplicationID]="ApplicationID"
                                         [UploadFor]="fileAttrsName"
                                         (passFileName)="onPassFileName($event)"
                                         (onUploadFinished)="onFileDelete($event, 0)"
                                         (onUploadSuccess)="onFileUpload($event)">
                        </app-file-upload>
                      </div>
                    </div>




                  </div>

                </div>

              </div>
            </div>
          </mat-toolbar>
        </div>
      </mat-form-field>



      <!--this is for the deposit required  (click)="saveDeposit(deposit)"-->
      <mat-checkbox class="example-margin" *ngIf="canComment == true || canCommentSeniorReviewer == true && canCommentFinalApprover == false" [(ngModel)]="checked" (click)="getAllServiceItmesForDropdown(deposit)">Deposit Required</mat-checkbox>
    </div>


    <mat-spinner [diameter]="20" *ngIf="loading"></mat-spinner>
    <button mat-raised-button color="saveDoc" (click)="saveDocument()" *ngIf="CurrentApplication.isPlanning === true && saveBtn">Save</button>
    <div class="cont4" *ngIf="permit && canApprovePermit">
      <mat-form-field class="example-full-width">
        <!--|| canCommentFinalApprover == true-->
        <mat-label>Type new comment</mat-label>
        <textarea matInput [(ngModel)]="leaveACommentPermit" placeholder="Eg. This is good"></textarea>

      </mat-form-field>
      <button mat-raised-button color="purple" [matMenuTriggerFor]="menu" (click)="getAllCommentsByUserID()"><i class="fa fa-comment" aria-hidden="true"></i></button>
      <mat-menu #menu="matMenu" xPosition="before">
        <button mat-menu-item *ngFor="let comment of CommentDropDown" value="{{comment.commentID}}" (click)="populateCommentPermit(comment.commentName)">{{comment.commentName}} </button>

      </mat-menu>


    </div>
    <div class="cont6" *ngIf="permit && canApprovePermit">
      <button mat-raised-button color="approvePermit" *ngIf="canApprovePermit" (click)="PermitIssue('Approve')">Approve Permit</button>
      <button mat-raised-button color="meetOnSite" *ngIf="canApprovePermit" (click)="PermitIssue('MeetOnSite')">Meet On Site</button>
      <button mat-raised-button color="rejectPermit" *ngIf="canApprovePermit" (click)="PermitIssue('Reject')">Reject Permit</button>
    </div>

  </div>

</ng-template>


<!--modal for when they click deposit required-->

<!---->


<ng-template #deposit let-modal>
  <div class="modal-header">
    <h1 class="modal-title">Deposit Required</h1>
    <button type="button" class="btn-close" aria-label="Close" (click)="uncheck();modal.dismiss('Cross click')"></button>
  </div>
  <div class="modal-body">
    <form [formGroup]="depositRequired">

      <div class="row">
        <mat-form-field>
          <mat-label>Select A Service Item</mat-label>
          <mat-select [(value)]="selectSI" (selectionChange)="onPopulateDeposit()">
            <mat-option *ngFor="let serviceItemCode of ServiceItemCodeDropdown" value="{{serviceItemCode.serviceItemID}}">{{serviceItemCode.serviceItemCode}}</mat-option>
          </mat-select>
        </mat-form-field>
      </div>


      <div class="row">
        <mat-form-field class="example-full-width">
          <mat-label>Description</mat-label>
          <textarea matInput formControlName="description" readonly></textarea>
        </mat-form-field>
      </div>

      <div class="row">
        <mat-form-field class="example-full-width">
          <mat-label>Remarks</mat-label>
          <textarea matInput formControlName="remarks"></textarea>
        </mat-form-field>
      </div>
      <div class="row">
        <div class="col">
          <div class="col">
            <div class="form-floating mb-3 mt-3">
              <input type="text" class="form-control" formControlName="rate" placeholder="Enter Rate">
              <label for="rate">Rate</label>
            </div>
          </div>
        </div>
        <div class="col">
          <div class="form-floating mb-3 mt-3">
            <input type="text" class="form-control" formControlName="quantity" placeholder="Enter Quantity">
            <label for="quantity">Quantity</label>
          </div>
        </div>
      </div>
      <div class="row">

        <div class="form-floating mb-3 mt-3">
          <input type="text" class="form-control" formControlName="total" placeholder="Enter Total" readonly>
          <label for="total">Total Amount(Vat Not Applicable)</label>
        </div>
        <div class="form-floating mb-3 mt-3" hidden>
          <input type="text" class="form-control" formControlName="vatApplicable" placeholder="Enter Total" hidden>
          <label for="total">VatApplicable</label>
        </div>
        <div class="alert alert-info" role="alert" *ngIf="totalCheck">Your Total Is : R{{totalAmount}}</div>
        <div class="alert alert-info" role="alert" *ngIf="totalCheckVat">Your Total Is : R{{totalAmount}}, Vat incl.</div>
      </div>

      <button mat-raised-button color="save" (click)="calculateTotalAmount()">Calculate Total</button>
    </form>
  </div>

  <div class="cont4">
    <button mat-raised-button color="warn" (click)="uncheck();modal.dismiss('Cross click')">Cancel</button>
    <button mat-raised-button color="save" (click)="onDepositRequiredClick();modal.close('Save click')">Save</button>

  </div>


</ng-template>

<ng-template #assign let-modal>
  <div class="modal-header">
    <h1 class="modal-title">Assign Department To Project</h1>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
  </div>
  <div class="modal-body">
    <mat-tab-group>
      <mat-tab label="Select departments">



        <table mat-table [dataSource]="dataSourceSubDepartment" class="mat-elevation-z8">

          <ng-container matColumnDef="subDepartmentName">
            <th mat-header-cell *matHeaderCellDef> Sub Department Name </th>
            <td mat-cell *matCellDef="let element"> {{element.subDepartmentName}} </td>
          </ng-container>


          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Actions</th>
            <td mat-cell *matCellDef="let i = index;let element">
              <mat-checkbox class="example-margin" (change)="departmentSelectedForLink(element)" [checked]="selection.isSelected(element)"></mat-checkbox>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumnsSubDepartment"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumnsSubDepartment;"></tr>
        </table>
      </mat-tab>

      <mat-tab label="View Selected Departments">

        <table mat-table [dataSource]="dataSourceLinkedSubDepartment" class="mat-elevation-z8">



          <ng-container matColumnDef="subDepartmentName">
            <th mat-header-cell *matHeaderCellDef> Sub Department Name </th>
            <td mat-cell *matCellDef="let element"> {{element.subDepartmentName}} </td>
          </ng-container>


          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Actions</th>
            <td mat-cell *matCellDef="let i = index;let element">
              <button mat-raised-button color="warn" (click)="deleteLinkedDepartmentForComment(i);modal.dismiss('Cross click');getAllSubDepartments()"><i class="fa fa-trash" aria-hidden="true"></i></button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumnsSubDepartment"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumnsLinkedSubDepartment;"></tr>
        </table>

      </mat-tab>
    </mat-tab-group>
  </div>
  <div class="modal-footer">
    <button type="submit" class="btn btn-outline-success" (click)="onLinkDepartmentForComment();modal.close('Save click');getAllSubDepartments()">Save</button>
  </div>

</ng-template>

<ng-template #assignProjectToZone let-modal>
  <div class="modal-header">
    <h1 class="modal-title">Assign Project to Zone</h1>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
  </div>
  <div class="modal-body">
    <mat-tab-group>
      <mat-tab label="Select Zones">



        <table mat-table [dataSource]="dataSourceViewLinkedSubZones" class="mat-elevation-z8">

          <ng-container matColumnDef="zoneName">
            <th mat-header-cell *matHeaderCellDef> Zone Name  </th>
            <td mat-cell *matCellDef="let element"> {{element.zoneName}} </td>
          </ng-container>


          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Actions</th>
            <td mat-cell *matCellDef="let i = index;let element">
              <mat-checkbox class="example-margin" (change)="zoneSelectedForLink(element)" [checked]="zoneSelection.isSelected(element)"></mat-checkbox>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumnsViewLinkedSubZones"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumnsViewLinkedSubZones;"></tr>
        </table>
      </mat-tab>

      <mat-tab label="Linked Zones">

        <table mat-table [dataSource]="dataSourceViewLinkedZones" class="mat-elevation-z8">



          <ng-container matColumnDef="zoneName">
            <th mat-header-cell *matHeaderCellDef> Zone Name </th>
            <td mat-cell *matCellDef="let element"> {{element.zoneName}} </td>
          </ng-container>


          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Actions</th>
            <td mat-cell *matCellDef="let i = index;let element">
              <button mat-raised-button color="warn" (click)="deleteLinkedZoneForComment(i);modal.dismiss('Cross click')"><i class="fa fa-trash" aria-hidden="true"></i></button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumnsViewLinkedZones"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumnsViewLinkedZones;"></tr>
        </table>

      </mat-tab>
    </mat-tab-group>
  </div>
  <div class="modal-footer">
    <button type="submit" class="btn btn-outline-success" (click)="onLinkZoneForComment();modal.close('Save click')">Save</button>
  </div>

</ng-template>

<ng-template #assignProjectToUser let-modal>
  <div class="modal-header">
    <h1 class="modal-title">Assign User For Comment</h1>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
  </div>
  <div class="modal-body">
    <mat-tab-group>
      <mat-tab label="Select User(s)">

        <!--<div class="form-floating mb-3 mt-3" >
          <select class="form-select" aria-label="Default select example" formControlName="selectedZone" (change)="onSelectToPopulateZoneUsers($event,newUserLinkedToZone)">
            <option selected value="0">select a zone</option>
            <option *ngFor="let zone of ZoneDropdown" value="{{zone.zoneID}}">{{zone.zoneName}}</option>
          </select>

        </div>-->

        <table mat-table [dataSource]="dataSourceViewUsersForLink" class="mat-elevation-z8">

          


          <ng-container matColumnDef="fullName">
            <th mat-header-cell *matHeaderCellDef> User Name  </th>
            <td mat-cell *matCellDef="let element"> {{element.fullName}} </td>
          </ng-container>


          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Actions</th>
            <td mat-cell *matCellDef="let i = index;let element">
              <mat-radio-button class="example-margin" (change)="userSelectedForManualLink(element)" [checked]="UserSelectionForManualLink.isSelected(element)">
              </mat-radio-button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumnsViewUsersForLink"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumnsViewUsersForLink;"></tr>
        </table>
      </mat-tab>

      <mat-tab label="View Selected User(s)">

        <!--<div class="form-floating mb-3 mt-3" *ngIf="showZone">
          <select class="form-select" aria-label="Default select example" formControlName="viewSelectedZone" (change)="onSelectToPopulateZoneUsers($event,newUserLinkedToZone)">
            <option selected value="0">select a zone</option>
            <option *ngFor="let zone of ZoneDropdown" value="{{zone.zoneID}}">{{zone.zoneName}}</option>
          </select>
           
        </div>-->

        <table mat-table [dataSource]="dataSourceViewUserForComment" class="mat-elevation-z8">



      



          <ng-container matColumnDef="fullName">
            <th mat-header-cell *matHeaderCellDef> User Name </th>
            <td mat-cell *matCellDef="let element"> {{element.fullName}} </td>
          </ng-container>


          <!--<ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Actions</th>
            <td mat-cell *matCellDef="let i = index;let element">-->
          <!-- <button mat-raised-button color="warn" (click)="deleteLinkedZoneForComment(i);modal.dismiss('Cross click')"><i class="fa fa-trash" aria-hidden="true"></i></button>-->
          <!--</td>
          </ng-container>-->

          <tr mat-header-row *matHeaderRowDef="displayedColumnsViewlinkedUserForComment"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumnsViewlinkedUserForComment;"></tr>
        </table>

      </mat-tab>
    </mat-tab-group>
  </div>
  <div class="modal-footer">
    <button type="submit" class="btn btn-outline-success" (click)="modal.close('Save click');onManuallyAssignUser()">Save</button>
  </div>

</ng-template>


<ng-template #depositOrWBSNumber let-modal>
  <div class="modal-header">
    <h1 class="modal-title">Approve</h1>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
  </div>
  <div class="modal-body">


    <h3>Do you want to add a deposit required ?</h3>
    <h3>Do you want to add a WBS Number ?</h3>
    <div class="cont3">
      <button mat-button>No</button>
      <button mat-raised-button (click)="depositReqModal(deposit)">Yes</button>

    </div>

  </div>

</ng-template>


<!--This is for the wbs number-->

<ng-template #wbsNumberModal let-modal>
  <div class="modal-header">
    <h1 class="modal-title">WBS Number</h1>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
  </div>
  <div class="modal-body">
    <form [formGroup]="wbs">
      <div class="form-floating mb-3 mt-3">
        <input type="text" class="form-control" formControlName="wbsnumber" placeholder="wbsnumber">
        <label for="wbsnumber">WBS Number</label>
      </div>
    </form>
  </div>
  <div class="modal-footer">
    <button type="submit" class="btn btn-outline-success" (click)="onCreateWBSNumber();modal.close('Save click')">Save</button>
  </div>
</ng-template>
